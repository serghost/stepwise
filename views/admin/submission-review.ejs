<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏—è | Stepwise</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="admin-layout">
    <%- include('partials/sidebar', { active: 'submissions' }) %>
    
    <main class="admin-main">
      <div class="breadcrumb">
        <a href="/admin/submissions">–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏–π</a>
        <span class="breadcrumb-sep">‚Üí</span>
        <span><%= submission.user_name %></span>
      </div>
      
      <div class="page-header">
        <h1 class="page-title">–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏—è</h1>
      </div>
      
      <div class="grid grid-2" style="gap: 2rem;">
        <div>
          <div class="card" style="margin-bottom: 1.5rem;">
            <h3 style="margin-bottom: 1rem;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <table style="width: 100%;">
              <tr>
                <td class="text-muted" style="padding: 0.5rem 0;">–£—á–µ–Ω–∏–∫:</td>
                <td style="padding: 0.5rem 0;"><strong><%= submission.user_name %></strong></td>
              </tr>
              <tr>
                <td class="text-muted" style="padding: 0.5rem 0;">Email:</td>
                <td style="padding: 0.5rem 0;"><%= submission.email %></td>
              </tr>
              <tr>
                <td class="text-muted" style="padding: 0.5rem 0;">–ö—É—Ä—Å:</td>
                <td style="padding: 0.5rem 0;"><%= submission.course_title %></td>
              </tr>
              <tr>
                <td class="text-muted" style="padding: 0.5rem 0;">–°—Ç–µ–ø:</td>
                <td style="padding: 0.5rem 0;"><%= submission.step_title %> (#<%= submission.step_position %>)</td>
              </tr>
              <tr>
                <td class="text-muted" style="padding: 0.5rem 0;">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:</td>
                <td style="padding: 0.5rem 0;"><%= new Date(submission.submitted_at).toLocaleString('ru-RU') %></td>
              </tr>
            </table>
          </div>
          
          <% if (submission.step_content) { %>
            <div class="card" style="margin-bottom: 1.5rem;">
              <h3 style="margin-bottom: 1rem;">–ó–∞–¥–∞–Ω–∏–µ</h3>
              <div class="text-muted">
                <%- submission.step_content.replace(/\n/g, '<br>') %>
              </div>
            </div>
          <% } %>
          
          <div class="card">
            <h3 style="margin-bottom: 1rem;">–û—Ç–≤–µ—Ç —É—á–µ–Ω–∏–∫–∞</h3>

            <% if (submission.text_answer) { %>
              <div style="margin-bottom: 1rem;">
                <label class="form-label" style="margin-bottom: 0.5rem;">–¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç:</label>
                <div class="answer-text" style="background: var(--bg-tertiary); padding: 1rem; border-radius: 8px;">
                  <%- submission.text_answer.replace(/\n/g, '<br>') %>
                </div>
              </div>
            <% } %>

            <% if (submission.file_url) { %>
              <div>
                <label class="form-label" style="margin-bottom: 0.5rem;">–§–∞–π–ª:</label>
                <% if (submission.file_url.match(/\.(mp4|webm|mov)$/i)) { %>
                  <div class="video-container">
                    <video controls style="width: 100%;">
                      <source src="<%= submission.file_url %>" type="video/mp4">
                    </video>
                  </div>
                <% } else { %>
                  <a href="<%= submission.file_url %>" target="_blank" class="btn btn-secondary">
                    üìé –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª
                  </a>
                <% } %>
              </div>
            <% } %>

            <% if (!submission.file_url && !submission.text_answer) { %>
              <p class="text-muted">–û—Ç–≤–µ—Ç –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω</p>
            <% } %>
          </div>
        </div>
        
        <div>
          <div class="card" style="margin-bottom: 1.5rem;">
            <h3 style="margin-bottom: 1rem; color: var(--success);">‚úÖ –ü—Ä–∏–Ω—è—Ç—å</h3>
            <p class="text-muted" style="margin-bottom: 1rem;">
              –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —Ö–æ—Ä–æ—à–æ. –£—á–µ–Ω–∏–∫—É –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π —Å—Ç–µ–ø.
            </p>
            <form method="POST" action="/admin/submissions/<%= submission.id %>/approve">
              <button type="submit" class="btn btn-success" style="width: 100%;">
                –ü—Ä–∏–Ω—è—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Å—Ç–µ–ø
              </button>
            </form>
          </div>
          
          <div class="card">
            <h3 style="margin-bottom: 1rem; color: var(--error);">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</h3>
            <p class="text-muted" style="margin-bottom: 1rem;">
              –ó–∞–¥–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏. –ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è —É—á–µ–Ω–∏–∫–∞.
            </p>
            <form method="POST" action="/admin/submissions/<%= submission.id %>/reject">
              <div class="form-group">
                <textarea name="comment" class="form-textarea" rows="4" required placeholder="–û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å..."></textarea>
              </div>
              <button type="submit" class="btn btn-danger" style="width: 100%;">
                –û—Ç–∫–ª–æ–Ω–∏—Ç—å —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º
              </button>
            </form>
          </div>
          
          <div style="margin-top: 1.5rem;">
            <a href="/admin/submissions" class="btn btn-secondary" style="width: 100%;">
              ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
            </a>
          </div>
        </div>
      </div>
    </main>
  </div>
</body>
</html>
