<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°—Ç–µ–ø—ã: <%= course.title %> | Stepwise</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="admin-layout">
    <%- include('partials/sidebar', { active: 'courses' }) %>
    
    <main class="admin-main">
      <div class="breadcrumb">
        <a href="/admin/courses">–ö—É—Ä—Å—ã</a>
        <span class="breadcrumb-sep">‚Üí</span>
        <span><%= course.title %></span>
      </div>
      
      <div class="page-header">
        <h1 class="page-title">–°—Ç–µ–ø—ã: <%= course.title %></h1>
        <p class="page-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º—ã–º –∫—É—Ä—Å–∞</p>
      </div>
      
      <div class="card" style="margin-bottom: 2rem;">
        <h3 class="card-title" style="margin-bottom: 1rem;">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–µ–ø</h3>
        <form method="POST" action="/admin/courses/<%= course.id %>/steps" enctype="multipart/form-data">
          <div class="form-group">
            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–µ–ø–∞</label>
            <input type="text" name="title" class="form-input" required placeholder="–£—Ä–æ–∫ 1: –í–≤–µ–¥–µ–Ω–∏–µ">
          </div>

          <div class="form-group">
            <label class="form-label">–¢–∏–ø —Å—Ç–µ–ø–∞</label>
            <div class="flex gap-2">
              <label class="radio-card">
                <input type="radio" name="step_type" value="info" onchange="toggleAnswerConfig(this)">
                <span class="radio-card-content">
                  <span class="radio-card-icon">üìñ</span>
                  <span class="radio-card-title">–ò–Ω—Ñ–æ</span>
                  <span class="radio-card-desc">–ü—Ä–æ—Å—Ç–æ –º–∞—Ç–µ—Ä–∏–∞–ª, –æ—Ç–≤–µ—Ç –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è</span>
                </span>
              </label>
              <label class="radio-card">
                <input type="radio" name="step_type" value="task" checked onchange="toggleAnswerConfig(this)">
                <span class="radio-card-content">
                  <span class="radio-card-icon">‚úèÔ∏è</span>
                  <span class="radio-card-title">–ó–∞–¥–∞–Ω–∏–µ</span>
                  <span class="radio-card-desc">–¢—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–≤–µ—Ç –æ—Ç —É—á–µ–Ω–∏–∫–∞</span>
                </span>
              </label>
            </div>
          </div>

          <div id="answerConfig" class="form-group">
            <label class="form-label">–¢–∏–ø –æ—Ç–≤–µ—Ç–∞</label>
            <div class="checkbox-group">
              <label class="checkbox-item">
                <input type="checkbox" name="answer_text" value="1">
                <span>–¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="answer_file" value="1" checked>
                <span>–§–∞–π–ª / –≤–∏–¥–µ–æ</span>
              </label>
            </div>
            <p class="form-help">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–ª–∏ –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞</p>
          </div>

          <div class="form-group">
            <label class="form-label">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ / –ó–∞–¥–∞–Ω–∏–µ</label>
            <textarea name="content" class="form-textarea" rows="5" placeholder="–û–ø–∏—à–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª –∏–ª–∏ –∑–∞–¥–∞–Ω–∏–µ..."></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">–í–∏–¥–µ–æ —É—Ä–æ–∫–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
            <input type="file" name="video" class="form-input" accept=".mp4,.mov,.webm,.avi">
            <p class="form-help">MP4, MOV, WebM ‚Äî –¥–æ 500 –ú–ë</p>
          </div>
          <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–µ–ø</button>
        </form>
      </div>
      
      <div class="card">
        <h3 class="card-title" style="margin-bottom: 1rem;">–°–ø–∏—Å–æ–∫ —Å—Ç–µ–ø–æ–≤</h3>
        
        <% if (steps.length === 0) { %>
          <div class="empty-state">
            <p class="empty-state-text">–í —ç—Ç–æ–º –∫—É—Ä—Å–µ –ø–æ–∫–∞ –Ω–µ—Ç —Å—Ç–µ–ø–æ–≤</p>
          </div>
        <% } else { %>
          <div class="steps-list">
            <% steps.forEach((step, index) => { %>
              <div class="step-item">
                <div class="step-number"><%= step.position %></div>
                <div class="step-content" style="flex: 1;">
                  <div class="step-title">
                    <%= step.title %>
                    <% if (step.step_type === 'info') { %>
                      <span class="badge badge-secondary" style="margin-left: 0.5rem;">üìñ –∏–Ω—Ñ–æ</span>
                    <% } else { %>
                      <span class="badge badge-primary" style="margin-left: 0.5rem;">‚úèÔ∏è –∑–∞–¥–∞–Ω–∏–µ</span>
                    <% } %>
                    <% if (step.video_url) { %>
                      <span class="badge badge-info" style="margin-left: 0.25rem;">üé¨</span>
                    <% } %>
                  </div>
                  <% if (step.content) { %>
                    <div class="text-muted text-sm" style="margin-top: 0.25rem;">
                      <%= step.content.substring(0, 100) %><%= step.content.length > 100 ? '...' : '' %>
                    </div>
                  <% } %>
                </div>
                <div class="flex gap-1">
                  <form method="POST" action="/admin/steps/<%= step.id %>/move" style="display: inline;">
                    <input type="hidden" name="direction" value="up">
                    <button type="submit" class="btn btn-secondary btn-icon" <%= index === 0 ? 'disabled' : '' %>>‚Üë</button>
                  </form>
                  <form method="POST" action="/admin/steps/<%= step.id %>/move" style="display: inline;">
                    <input type="hidden" name="direction" value="down">
                    <button type="submit" class="btn btn-secondary btn-icon" <%= index === steps.length - 1 ? 'disabled' : '' %>>‚Üì</button>
                  </form>
                  <a href="/admin/steps/<%= step.id %>/edit" class="btn btn-secondary btn-sm">‚úèÔ∏è</a>
                  <form method="POST" action="/admin/steps/<%= step.id %>/delete" style="display: inline;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Å—Ç–µ–ø?')">
                    <button type="submit" class="btn btn-danger btn-sm">üóëÔ∏è</button>
                  </form>
                </div>
              </div>
            <% }) %>
          </div>
        <% } %>
      </div>
    </main>
  </div>
<script>
function toggleAnswerConfig(radio) {
  const config = document.getElementById('answerConfig');
  config.style.display = radio.value === 'task' ? 'block' : 'none';
}
</script>
</body>
</html>
